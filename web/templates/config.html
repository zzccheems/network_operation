{% extends "base.html" %}
{% block title %}批量配置 - 网络自动化运维系统{% endblock %}
{% block style %}
.loading { display: none; color: #3498db; }
{% endblock %}
{% block content %}
<h2>设备批量配置</h2>
<form id="configForm" method="post">
    <div style="margin: 10px 0;">
        <label>选择设备组：</label>
        <select name="group_name" required style="padding: 5px; width: 200px;">
            {% for group in group_names %}
                <option value="{{ group }}">{{ group }}</option>
            {% endfor %}
        </select>
    </div>
    <div style="margin: 10px 0;">
        <label>选择配置模板：</label>
        <select name="tpl_name" required style="padding: 5px; width: 200px;">
            {% for tpl in tpl_files %}
                <option value="{{ tpl }}">{{ tpl }}</option>
            {% endfor %}
        </select>
    </div>
    <div style="margin: 10px 0;">
        <label>模板参数（JSON格式）：</label><br>
        <textarea name="tpl_params" rows="5" cols="50" placeholder='{"vlan_id":10, "vlan_name":"IT"}'></textarea>
        <p style="font-size: 12px; color: #666;">示例：{"vlan_id":10, "vlan_name":"IT"}</p>
    </div>
    <button type="submit" class="btn">执行配置</button>
    <div class="loading">正在配置，请稍候...</div>
</form>

<div id="resultArea" class="result-box" style="display: none;"></div>

<script>
// 异步执行配置
document.getElementById('configForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const loading = document.querySelector('.loading');
    const resultArea = document.getElementById('resultArea');
    
    loading.style.display = 'block';
    resultArea.style.display = 'none';
    
    fetch('/config', {
        method: 'POST',
        body: formData
    }).then(response => response.json())
      .then(data => {
          loading.style.display = 'none';
          resultArea.style.display = 'block';
          if (data.status === 'success') {
              resultArea.innerHTML = '<div class="success">配置成功！</div>' + 
                                    '<pre>' + JSON.stringify(data.result, null, 2) + '</pre>';
          } else {
              resultArea.innerHTML = '<div class="error">配置失败：' + data.message + '</div>';
          }
      })
      .catch(error => {
          loading.style.display = 'none';
          resultArea.style.display = 'block';
          resultArea.innerHTML = '<div class="error">请求失败：' + error + '</div>';
      });
});
</script>
{% endblock %}